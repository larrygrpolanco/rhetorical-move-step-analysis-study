S1: Reinforcement learning (RL) algorithms hypothesize that, in value-based decision-making tasks, animals maintain an action value map and update it using reward prediction errors (RPE), the difference between the observed and predicted reward associated with the chosen action [1]. [M1_S2]

S2: The growing family of RL models has proved remarkably successful for explaining trial-by-trial changes in behavior [2–4] and the responses of dopamine neurons in rodents and primates [5–7]. [M1_S2]

S3: However, these standard RL (SRL) models may not account as well for behavioral and neural data when sensory observations are not sufficient to determine optimal behavior, for example, when the underlying reward distribution changes over time due to the existence of a hidden state. [M2_S1e]

S4: To solve such tasks, evidence suggests that the brain represents a “belief state” (a probability distribution over hidden states), updated by Bayesian inference [8–12], or possibly learned implicitly in an end-to-end fashion [13]. [M2_S1b]

S5: The significance of Bayesian inference becomes apparent when studying mouse behavior in a two-armed bandit task (2ABT, Fig. 1A), a serial reversal learning task where rewards for correct choices are delivered on a probabilistic schedule, and the correct port switches between two available options across blocks of trials within a single session. [M3_S4c]

S6: Both mice and human subjects trained in this task are capable of maintaining stable behavior within a block, and then rapidly adapting after reward contingencies reverse following a block switch [14–16]. [M3_S5]

S7: The simplest versions of standard RL models do not capture choice stability within a block and rapid switching when the rewarded port changes [15, 16]. [M2_S1a]

S8: The limitations of a purely Bayesian account of reversal learning were also challenged by recent behavioral analyses of mice performing the 2ABT [16]. [M2_S1e]

S9: Here we report data from mice performing the 2ABT along with recording of dopamine release events in the nucleus accumbens core (NAc) using fiber photometry imaging of dLight [17]. [M3_S1]

S10: These data allow us to compare Bayesian and SRL models to examine which computations mice use to solve the 2ABT. [M3_S5]

S11: In addition to comparing “pure” Bayesian and SRL models, it is also valuable to include a hybrid model, as past studies suggest that Bayesian and RL processes may be combined in the brain [8, 18, 19]. [M3_S6]

S12: Therefore, we also examined a belief state RL model (BRL), where Bayesian inference is used to compute belief states, over which RL processes operate to learn policies appropriate for the current belief state. [M3_S5]

S13: Past studies have shown that dopamine signaling may be better explained by models accounting for belief states [8–10, 12, 20]. [M2_S2]

S14: We hypothesized that RPE signals generated by the BRL model would match dopamine measurements more closely than RPE signals generated by alternative models. [M3_S2b]

S15: We also hypothesized that the BRL model would better match the choice data, in particular the rapid adaptation to block switches exhibited by mice. [M3_S2b]